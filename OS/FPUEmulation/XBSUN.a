;
;	File:		XBSUN.a
;
;	Contains:	Routine to handle 'Branch/Set on UNordered exception
;
;	Originally Written by:	Motorola Inc.
;	Adapted to Apple/MPW:	Jon Okada
;
;	Copyright:	© 1990, 1991 by Apple Computer, Inc., all rights reserved.
;
;   This file is used in these builds:   Mac32
;
;	Change History (most recent first):
;
;		 <2>	 3/30/91	BG		Rolling in Jon Okada's latest changes.
;		 <1>	12/14/90	BG		First checked into TERROR/BBS.

;  xbsun.a

;  Based upon Motorola file 'x_bsun.sa'

;  CHANGE LOG:
;  08 Jan 91	JPO	Inserted label 'bsun' at top of code.  Modified
;			code to branch to user handler.
;

*
*	x_bsun.sa 3.1 12/10/90
*
*	fpsp_bsun --- FPSP handler for branch/set on unordered exception
*
*	Copy the PC to FPIAR to maintain 881/882 compatability
*
*	The real_bsun handler will need to perform further corrective
*	measures as outlined in the 040 User's Manual on pages
*	9-41f, section 9.8.3.
*

*		Copyright (C) Motorola, Inc. 1990
*			All Rights Reserved
*
*	THIS IS UNPUBLISHED PROPRIETARY SOURCE CODE OF MOTOROLA 
*	The copyright notice above does not evidence any  
*	actual or intended publication of such source code.

* X_BSUN	IDNT    2,1 Motorola 040 Floating Point Software Package


bsun:				; <1/8/91, JPO>
fpsp_bsun:
*
	link	a6,#-LOCAL_SIZE
	fsave	-(a7)
	movem.l	d0-d1/a0-a1,USER_DA(a6)
	fmovem.x fp0-fp3,USER_FP0(a6)
	fmovem.l fpcr/fpsr/fpiar,USER_FPCR(a6)
*
	move.l	EXC_PC(a6),USER_FPIAR(a6)
*
	movem.l	USER_DA(a6),d0-d1/a0-a1
	fmovem.x USER_FP0(a6),fp0-fp3
	fmovem.l USER_FPCR(a6),fpcr/fpsr/fpiar
	frestore (a7)+
	unlk	a6

;	bra.l	real_bsun		; deleted <1/8/91, JPO>

	move.l	(FPBSUN_VEC040).W,-(sp)	; push vector to user's handler <1/8/91, JPO>
	rts				; execute user's handler <1/8/91, JPO>
*

